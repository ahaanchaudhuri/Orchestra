version: 1
name: "Everything Server HTTP Test"

server:
  transport: "http"
  url: "http://localhost:3005/mcp"

env:
  TEST_MESSAGE: "Hello from MCP tester!"

defaults:
  timeout_ms: 10000
  retries: 0

steps:
  # Step 1: Call the echo tool
  - id: echo_test
    type: tool_call
    tool: "echo"
    input:
      message: "{{env.TEST_MESSAGE}}"
    save: "$"

  # Step 2: Assert echo response has no error
  - id: assert_echo_no_error
    type: assert
    from: "echo_test"
    check:
      op: "no_error"

  # Step 3: Assert echo content exists
  - id: assert_echo_content
    type: assert
    from: "echo_test"
    check:
      op: "jsonpath_exists"
      path: "$.content[0].text"

  # Step 4: Assert echo message contains expected text
  - id: assert_echo_message
    type: assert
    from: "echo_test"
    check:
      op: "jsonpath_contains"
      path: "$.content[0].text"
      value: "Hello from MCP tester!"

  # Step 5: Call add tool (this tool doesn't exist, should error)
  - id: add_numbers
    type: tool_call
    tool: "add"
    input:
      a: 5
      b: 3
    save: "$"

  # Step 6: Assert that add call returns an error
  - id: assert_add_is_error
    type: assert
    from: "add_numbers"
    check:
      op: "is_error"

